{"version":3,"file":"app-9fc19d23.js","sources":["../node_modules/three/examples/jsm/WebGL.js","../source/validator.ts","../source/errors.ts","../source/app.ts"],"sourcesContent":["/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\n\n\n\nvar WEBGL = {\n\n\tisWebGLAvailable: function () {\n\n\t\ttry {\n\n\t\t\tvar canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t},\n\n\tisWebGL2Available: function () {\n\n\t\ttry {\n\n\t\t\tvar canvas = document.createElement( 'canvas' );\n\t\t\treturn !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );\n\n\t\t} catch ( e ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t},\n\n\tgetWebGLErrorMessage: function () {\n\n\t\treturn this.getErrorMessage( 1 );\n\n\t},\n\n\tgetWebGL2ErrorMessage: function () {\n\n\t\treturn this.getErrorMessage( 2 );\n\n\t},\n\n\tgetErrorMessage: function ( version ) {\n\n\t\tvar names = {\n\t\t\t1: 'WebGL',\n\t\t\t2: 'WebGL 2'\n\t\t};\n\n\t\tvar contexts = {\n\t\t\t1: window.WebGLRenderingContext,\n\t\t\t2: window.WebGL2RenderingContext\n\t\t};\n\n\t\tvar message = 'Your $0 does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">$1</a>';\n\n\t\tvar element = document.createElement( 'div' );\n\t\telement.id = 'webglmessage';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( contexts[ version ] ) {\n\n\t\t\tmessage = message.replace( '$0', 'graphics card' );\n\n\t\t} else {\n\n\t\t\tmessage = message.replace( '$0', 'browser' );\n\n\t\t}\n\n\t\tmessage = message.replace( '$1', names[ version ] );\n\n\t\telement.innerHTML = message;\n\n\t\treturn element;\n\n\t}\n\n};\n\nexport { WEBGL };\n","import { WEBGL } from 'three/examples/jsm/WebGL.js';\r\n\r\nconst offscreenCanvasErrorMessage = 'OffscreenCanvas is not supported';\r\n\r\nexport const validateWebGL = (): string | null => {\r\n  if (WEBGL.isWebGL2Available() !== true) {\r\n    return WEBGL.getWebGL2ErrorMessage().textContent;\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n\r\n  if (!canvas.transferControlToOffscreen) {\r\n    return offscreenCanvasErrorMessage;\r\n  }\r\n\r\n  try {\r\n    canvas.transferControlToOffscreen();\r\n  } catch(e) {\r\n    return offscreenCanvasErrorMessage;\r\n  }\r\n\r\n  return null;\r\n};\r\n","export const showError = (error: string): void => {\r\n  const errorMessage = document.querySelector('#error #message');\r\n  if (errorMessage) {\r\n    errorMessage.textContent = error;\r\n    document.querySelector('#error')?.classList.remove('hide');\r\n  }\r\n};\r\n","import '@stylesheet/style.scss';\r\nimport { validateWebGL } from './validator';\r\nimport { showError } from './errors';\r\n\r\nconst error = validateWebGL();\r\n\r\nif (!error) {\r\n  const gameCanvas = document.querySelector<HTMLCanvasElement>('#game');\r\n\r\n  if (!gameCanvas) {\r\n    throw new Error('cannot find game canvas');\r\n  }\r\n\r\n  const onWindowResize = (): void => {\r\n    gameCanvas.setAttribute('width', window.innerWidth.toString());\r\n    gameCanvas.setAttribute('height', window.innerHeight.toString());\r\n  };\r\n\r\n  onWindowResize();\r\n\r\n  const offscreen = gameCanvas.transferControlToOffscreen();\r\n\r\n  const worker = new Worker('./space/space.worker.ts', { type: 'module' });\r\n\r\n  const addCanvasEventListeners = (): void => {\r\n    gameCanvas.addEventListener('wheel', (event) => {\r\n      const deltaY = event.deltaY > 0 ? 1 : -1;\r\n      worker.postMessage({\r\n        topic: 'wheel',\r\n        deltaY\r\n      });\r\n    });\r\n\r\n    gameCanvas.addEventListener('mousedown', () => {\r\n      worker.postMessage({\r\n        topic: 'mousedown'\r\n      });\r\n    });\r\n\r\n    gameCanvas.addEventListener('mouseup', () => {\r\n      worker.postMessage({\r\n        topic: 'mouseup'\r\n      });\r\n    });\r\n\r\n    gameCanvas.addEventListener('mousemove', (event: MouseEvent) => {\r\n      worker.postMessage({\r\n        topic: 'mousemove',\r\n        event: {\r\n          movementX: event.movementX,\r\n          movementY: event.movementY,\r\n          x: (event.clientX / window.innerWidth) * 2 - 1,\r\n          y: - (event.clientY / window.innerHeight) * 2 + 1,\r\n        },\r\n      });\r\n    });\r\n\r\n    window.addEventListener('resize', () => {\r\n      onWindowResize();\r\n      worker.postMessage({\r\n        topic: 'resize',\r\n        size: {\r\n          width: window.innerWidth,\r\n          height: window.innerHeight,\r\n        },\r\n      });\r\n    });\r\n  };\r\n\r\n  worker.onmessage = ({ data }): void => {\r\n    if (data.success) {\r\n      addCanvasEventListeners();\r\n    } else if (data.error) {\r\n      showError(data.error);\r\n    }\r\n  };\r\n\r\n  worker.postMessage({ topic: 'canvas', canvas: offscreen }, {\r\n    transfer: [offscreen],\r\n  });\r\n} else {\r\n  showError(error);\r\n}\r\n"],"names":["WEBGL","isWebGLAvailable","canvas","document","createElement","window","WebGLRenderingContext","getContext","e","isWebGL2Available","WebGL2RenderingContext","getWebGLErrorMessage","this","getErrorMessage","getWebGL2ErrorMessage","version","contexts","1","2","message","element","id","style","fontFamily","fontSize","fontWeight","textAlign","background","color","padding","width","margin","replace","innerHTML","showError","error","errorMessage","querySelector","textContent","classList","remove","transferControlToOffscreen","validateWebGL","gameCanvas","Error","onWindowResize","setAttribute","innerWidth","toString","innerHeight","offscreen","worker","Worker","type","addCanvasEventListeners","addEventListener","event","deltaY","postMessage","topic","movementX","movementY","x","clientX","y","clientY","size","height","onmessage","data","success","transfer"],"mappings":"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"}